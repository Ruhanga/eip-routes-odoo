<routes xmlns="http://camel.apache.org/schema/spring">

    <route id="order-line-quantity-handler" errorHandlerRef="watcherErrorHandler">
        <from uri="direct:order-line-quantity-handler" />

        <log loggingLevel="DEBUG" message="Start: route with id ${routeId}" />

        <when>
            <simple>${exchangeProperty.order-quantity} != ${exchangeProperty.order-line.get('product_uom_qty')}</simple>
            <log message="Item quantity changed from ${exchangeProperty.order-line.get('product_uom_qty')} to ${exchangeProperty.order-quantity}" />

            <setProperty name="hasChanges">
                <simple>true</simple>
            </setProperty>
        </when>

        <when>
            <simple>${exchangeProperty.unitsId} != ${exchangeProperty.order-line.get('product_uom')[0]}</simple>
            <log message="Item quantity units changed from ${exchangeProperty.order-line.get('product_uom')[0]} to ${exchangeProperty.unitsId}" />

            <setProperty name="hasChanges">
                <simple>true</simple>
            </setProperty>
        </when>

        <choice>
            <when>
                <simple>${exchangeProperty.hasChanges} == true</simple>
                <setProperty name="odoo-operation">
                    <simple>write</simple>
                </setProperty>

                <log message="Found changes, updating item on quotation" />

                <to uri="direct:odoo-manage-order-line" />
            </when>
            <otherwise>
                <log message="Item quantity and units are the same as those in odoo, nothing to update" />
            </otherwise>
        </choice>

        <log loggingLevel="DEBUG" message="End: route with id ${routeId}" />
    </route>

</routes>
