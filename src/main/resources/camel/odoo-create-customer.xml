<routes xmlns="http://camel.apache.org/schema/spring">

    <route id="odoo-create-customer" errorHandlerRef="watcherErrorHandler">
        <from uri="direct:odoo-create-customer" />

        <log message="Creating customer in odoo..." />

        <setProperty name="xmlrpc-client-config">
            <spel>#{new org.apache.xmlrpc.client.XmlRpcClientConfigImpl()}</spel>
        </setProperty>
        <setProperty name="xmlrpc-client">
            <spel>#{new org.apache.xmlrpc.client.XmlRpcClient()}</spel>
        </setProperty>
        <script>
            <spel>
                #{getProperty('xmlrpc-client-config').setServerURL(new java.net.URL('{{odoo.baseUrl}}/xmlrpc/2/object'))}
            </spel>
        </script>
		<setProperty name="patient-data">
			<spel>#{new java.util.HashMap()}</spel>
		</setProperty>
		<script>
			<spel>
				#{getProperty('patient-data').put('name', getProperty('patient-name'))}
				#{getProperty('patient-data').put('ref', getProperty('order-instance').patient.uuid)}
			</spel>
		</script>
        <setProperty name="create-params">
            <spel>#{new java.util.ArrayList()}</spel>
        </setProperty>
        <script>
            <spel>
				#{getProperty('create-params').add('{{odoo.database}}')}
				#{getProperty('create-params').add(getProperty('odoo-user-id'))}
				#{getProperty('create-params').add('{{odoo.password}}')}
				#{getProperty('create-params').add('res.partner')}
				#{getProperty('create-params').add('create')}
				#{getProperty('create-params').add(T(java.util.Collections).singletonList(getProperty('patient-data')))}
			</spel>
        </script>
		<setBody>
			<spel>
				#{getProperty('xmlrpc-client').execute(getProperty('xmlrpc-client-config'), 'execute_kw', getProperty('create-params'))}
			</spel>
		</setBody>

        <log message="Successfully created customer in odoo!" />
    </route>

</routes>