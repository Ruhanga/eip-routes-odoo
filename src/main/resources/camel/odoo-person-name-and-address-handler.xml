<routes xmlns="http://camel.apache.org/schema/spring">

	<route id="odoo-person-name-and-address-handler" errorHandlerRef="watcherErrorHandler">
		<from uri="direct:odoo-person-name-and-address-handler" />

		<log message="Start: route with id ${routeId}" loggingLevel="DEBUG" />

        <log message="Loading patient associated to the ${exchangeProperty.patientAssociationName} from DB..." loggingLevel="DEBUG" />

        <setBody>
            <spel>#{exchange.context.registry.lookupByName(getProperty('tables-repo-map').get('patient')).findByUuid(getProperty('entity-instance').person.uuid)}</spel>
        </setBody>

        <log message="Loaded associated patient -> ${body}" loggingLevel="DEBUG" />

        <choice>
            <when>
                <simple>${body} != null</simple>
                <setProperty name="patient">
                    <simple>${body}</simple>
                </setProperty>

                <toD uri="direct:odoo-patient-handler" />
            </when>
            <otherwise>
                <log message="No associated patient found with uuid: ${exchangeProperty.entity-instance.person.uuid}" loggingLevel="WARN" />
            </otherwise>
        </choice>

		<log message="End: route with id ${routeId}" loggingLevel="DEBUG" />
	</route>

</routes>